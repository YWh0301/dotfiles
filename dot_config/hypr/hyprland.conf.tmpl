################
### MONITORS ###
################
# See https://wiki.hyprland.org/Configuring/Monitors/
source = ~/.config/hypr/monitors.conf #used with nwg-displays
{{ if eq .chezmoi.hostname "homeDesktop" -}}
# 家中台式机默认复制显示
monitor=,preferred,auto,auto,mirror,HDMI-A-1
{{ else -}}
monitor=,preferred,auto,auto
{{- end }}

###################
### MY PROGRAMS ###
###################
# See https://wiki.hyprland.org/Configuring/Keywords/

# Set programs that you use
$terminal = kitty
$browser = firefox
$fileManager = thunar
$menu = rofi -show drun

#################
### AUTOSTART ###
#################

# Autostart necessary processes (like notifications daemons, status bars, etc.)
# Or execute your favorite apps at launch like this:

exec-once = nwg-look -a
exec-once = hyprlock -c $HOME/.config/hypr/hyprlock_wall.conf
exec-once = hyprpaper # wallpaper
exec-once = blueman-applet # bluetooth manager systray applet
exec-once = nm-applet # network manager systray applet
exec-once = swaync # notification center
exec-once = waybar # panel
exec-once = fcitx5 # input method support
exec-once = wl-paste --watch cliphist store # clipboard manager
exec-once = /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1 #polkit gui interface
exec-once = hypridle # idle detector
{{- if eq .pcloud.client "pcloudcc" }}
exec-once = pcloudcc -m $HOME/.misc/pCloudDrive -u {{ .email.default }} -d
{{- else }}
exec-once = env HOME="$HOME/.misc/pCloudDrive" pcloud #pcloud would mount on a folder in home directory which is ugly so i change the home and created sim links in the folder to trick pcloud. remeber to also modify the exec in desktop entry of pcloud. furthermore pcloud only take absolute path so ~/ wont work.after this just set sync folder in the app then u can use it without any trouble.
{{- end }}
exec-once = echo "Xft.dpi:192" | xrdb -merge #xwayland scale set. doesnt seem to work on wechat but works on fcitx5 inside wechat.
exec-once = xkbcomp -w 0 $HOME/.config/custom.xkb $DISPLAY

#############################
### ENVIRONMENT VARIABLES ###
#############################
# See https://wiki.hyprland.org/Configuring/Environment-variables/

# language
env = LANG,zh_CN.UTF-8
# qt theme
env = QT_QPA_PLATFORMTHEME,qt6ct

# cursors
env = XCURSOR_SIZE,24
{{- if or (eq .chezmoi.hostname "homeDesktop") (eq .chezmoi.hostname "rogLaptop") }}
env = HYPRCURSOR_SIZE,24
env = HYPRCURSOR_THEME,rose-pine-hyprcursor
{{- end }}

{{- if eq .chezmoi.hostname "homeDesktop" }}
# nvidia support
# See https://wiki.hyprland.org/Nvidia
# since im tring to use amd gpu for hyprland ill comment these out:https://wiki.hyprland.org/Configuring/Multi-GPU/
# with hyprland using amdgpu as default and runtime d3 power saving for nvidia enabled, most of the time the nvidia graphic card would be in low power mode. use "cat /proc/driver/nvidia/gpus/0000:01:00.0/power" to check if runtime d3 is enabled and set at fine-grained mode. dont use nvidia-smi or nvtop to check power usage as those apps awake the nvidia gpu and keep it running so the power usage would be inaccurate.instead, use "watch -n1 -d -t cat /sys/bus/pci/devices/0000:01:00.0/power/runtime_status" to create a monitor of nvidia gpu status. if it works well, an 8h battery life can be expected with light weight tasks.
env = LIBVA_DRIVER_NAME,nvidia
env = GBM_BACKEND,nvidia-drm
env = __GLX_VENDOR_LIBRARY_NAME,nvidia
{{- end }}

# tell apps to use wayland
env = GDK_BACKEND,wayland,x11,*
env = QT_QPA_PLATFORM,wayland;xcb
env = SDL_VIDEODRIVER,wayland
env = CLUTTER_BACKEND,wayland
env = XDG_SESSION_TYPE,wayland
env = XDG_SESSION_DESKTOP,Hyprland
env = XDG_CURRENT_DESKTOP,Hyprland

# xwayland hidpi
# env = GDK_SCALE,2
# env = QT_SCALE_FACTOR,2

# fcitx5 for xwayland
env =  GTK_IM_NODULE,fcitx
env =  QT_IM_MODULE,fcitx5
env =  XMODIFIERS,@im=fcitx
env =  SDL_IM_MODULE,fcitx
env =  GFW_IM_MODULE,ibus

# editor
env = EDITOR,nvim

#####################
### LOOK AND FEEL ###
#####################

# Refer to https://wiki.hyprland.org/Configuring/Variables/

# gruvbox hyprland theme
source=~/.config/hypr/gruvbox.conf

# https://wiki.hyprland.org/Configuring/Variables/#general
general { 
    gaps_in = 0
    gaps_out = 0 

    border_size = 2
    col.active_border = rgb(b8bb26)
    col.inactive_border = rgb(666666)

    # Set to true enable resizing windows by clicking and dragging on borders and gaps
    resize_on_border = true 
    extend_border_grab_area = 15 
    hover_icon_on_border = true
    resize_corner = 3

    # Please see https://wiki.hyprland.org/Configuring/Tearing/ before you turn this on
    allow_tearing = false

    layout = master
}

windowrule = bordersize 0, floating:0, onworkspace:w[tv1]s[false], 

# https://wiki.hyprland.org/Configuring/Variables/#decoration
decoration {
    rounding = 0

    # shadow as a top border to indicate focused window
    shadow {
       enabled = false
    #   enabled = true
    #   range = 0
    #   render_power = 4
    #   color = rgb(b8bb26)
    #   color_inactive = rgba(ff000000)
    #   ignore_window = true
    #   scale = 1
    #   offset = 0 -3
    }
}

# https://wiki.hyprland.org/Configuring/Variables/#animations
animations {
    enabled = true

    # Default animations, see https://wiki.hyprland.org/Configuring/Animations/ for more

    #bezier = myBezier, 0.05, 0.9, 0.1, 1.05

    animation = windows, 1, 2, default,popin 80%
    animation = windowsOut, 0
    animation = fade, 0
    animation = fadeOut, 1, 3, default
    animation = windowsMove, 0, 4, default
    animation = border, 1, 4, default
    animation = borderangle, 1, 4, default
    animation = workspaces, 1, 3, default,slide
    animation = specialWorkspace, 1, 2, default,fade 
}

# See https://wiki.hyprland.org/Configuring/Master-Layout/ for more
master {
    new_status = master
    new_on_top = true
}

xwayland {
    force_zero_scaling = true
}

# https://wiki.hyprland.org/Configuring/Variables/#misc
misc { 
    force_default_wallpaper = 1 # Set to 0 or 1 to disable the anime mascot wallpapers
    disable_splash_rendering = true
    disable_hyprland_logo = true # If true disables the random hyprland logo / anime girl background. :(
}


#############
### INPUT ###
#############

# https://wiki.hyprland.org/Configuring/Variables/#input
input {
    kb_file = ~/.config/custom.xkb

    repeat_rate = 45
    repeat_delay = 200

    follow_mouse = 2
    off_window_axis_events = 0

    sensitivity = 0 # -1.0 - 1.0, 0 means no modification.

    touchpad {
        natural_scroll = true
        scroll_factor = 0.4
        drag_lock = true
    }
}

# https://wiki.hyprland.org/Configuring/Variables/#gestures
gestures {
    gesture = 3,horizontal,workspace
    workspace_swipe_distance = 200
    workspace_swipe_min_speed_to_force = 10 
    workspace_swipe_use_r = true
}

# Example per-device config
# See https://wiki.hyprland.org/Configuring/Keywords/#per-device-input-configs for more
device {
    name = epic-mouse-v1
    sensitivity = -0.5
}

cursor {
    # set for nvidia support
    # See https://wiki.hyprland.org/Nvidia
    no_hardware_cursors = true
}

####################
### KEYBINDINGSS ###
####################

# See https://wiki.hyprland.org/Configuring/Keywords/
$mainMod = SUPER # Sets "Windows" :ey as main modifier

# Example binds, see https://wiki.hyprland.org/Configuring/Binds/ for more
bind = $mainMod, Escape, killactive,
bind = $mainMod, G, togglefloating,
bind = $mainMod, G, exec, /usr/bin/bash $HOME/.config/hypr/scripts/resize_float.sh
bind = $mainMod, F, fullscreen,
bind = $mainMod, S, pin,

# Exec some apps
bind = $mainMod, T, exec, $terminal
bind = $mainMod, R, exec, $terminal -e zsh -i -c 'y; zsh'
bind = $mainMod, W, exec, $browser
bind = $mainMod, C, exec, $terminal -e zsh -i -c 'aichat; zsh'
bind = $mainMod Shift, C, exec, $browser --new-window chatgpt.com
bind = $mainMod, Space, exec, $menu
bind = $mainMod, E, exec, $fileManager
bind = $mainMod, V, exec,cliphist list | rofi -dmenu -display-columns 2 | cliphist decode | tee >(wl-copy) | wl-copy --primary
bind = $mainMod, P, exec, grim -g "$(slurp)" - | swappy -f -
bind = $mainMod Shift, P, exec, grim -g "$(slurp -d)" - | wl-copy
bind =         , Print, exec, grim -g "$(slurp)" - | swappy -f -
bind = Shift   , Print, exec, grim -g "$(slurp -d)" - | wl-copy
bind = $mainMod,Backspace, exec,hyprlock
{{- if contains "Laptop" .chezmoi.hostname }}
binde =         ,XF86MonBrightnessUp, exec,brightnessctl s +10%
binde =         ,XF86MonBrightnessDown, exec,brightnessctl s 10%-
{{- end }}
binde =         ,XF86AudioRaiseVolume, exec ,pactl set-sink-volume @DEFAULT_SINK@ +5%
binde =         ,XF86AudioLowerVolume, exec ,pactl set-sink-volume @DEFAULT_SINK@ -5%
binde =         ,XF86AudioMute, exec ,pactl set-sink-mute @DEFAULT_SINK@ toggle
{{- if eq .chezmoi.hostname "rogLaptop" }}
bind =          ,XF86Launch1,exec,notify-send "每年都有很多海狸被自己啃倒的瓶子砸死" # for 海狸
{{- end }}
bind = $mainMod, Delete, exec,wlogout -b 2
bind = $mainMod, Backspace, exec,hyprlock
bind = $mainMod Shift, Backspace, exec,hyprctl dispatcher exit

# submap for resizeing windows
bind = $mainMod, a, submap, resize
# will start a submap called "resize"
submap = resize
binde = , L, resizeactive, 15 0
binde = , H, resizeactive, -15 0
binde = , K, resizeactive, 0 -15
binde = , J, resizeactive, 0 15
binde = Shift, L, moveactive, 30 0
binde = Shift, H, moveactive, -30 0
binde = Shift, K, moveactive, 0 -30
binde = Shift, J, moveactive, 0 30
# escape from resizing mode
bind = , Escape, submap, reset
bind = $mainMod,catchall, submap, reset
bindr = , catchall,submap, reset # use bindr to trigger reset after release or else shift+j wont work
submap = reset

## submap for panic mode
#bind = $mainMod, P, submap, panic
## will start a submap called "panic"
#submap = panic
## escape from resizing mode
#bind = , Escape, submap, reset
## kill all windows in current workspace if any key gets pressed
#bind = $mainMod,catchall, exec, $HOME/.config/hypr/scripts/close_current_workspace.sh
#bindr = , catchall,exec, $HOME/.config/hypr/scripts/close_current_workspace.sh 
##bind = , mouse:272, exec, $HOME/.config/hypr/scripts/close_current_workspace.sh
##bind = , mouse:273, exec, $HOME/.config/hypr/scripts/close_current_workspace.sh
#submap = reset

## submap for tmux sessios.
#bind = $mainMod, Control_L, submap, unbindkeys
#submap = unbindkeys
#bind = $mainMod, F, fullscreen,
## tmux specific
#bind = $mainMod, A, sendshortcut,CTRL,B, # c-b, prefix
#
#bind = $mainMod, Tab, sendshortcut,CTRL,B, # c-b,w check session state
#bind = $mainMod, Tab, sendshortcut,,W,
#
#bind = $mainMod, D, sendshortcut,CTRL,B, # c-b,d detach
#bind = $mainMod, D, sendshortcut,,D,
#
#bind = $mainMod, Space, sendshortcut,CTRL,B, # c-b,n next window
#bind = $mainMod, Space, sendshortcut,,N,
#
#bind = $mainMod, W, sendshortcut,CTRL,B, # c-b,c new window
#bind = $mainMod, W, sendshortcut,,C,
#
## seem to work unstablly binding two modifier key at one time
##bind = $mainMod SHIFT, Escape, sendshortcut,CTRL,B, # c-b,& close window
##bind = $mainMod SHIFT, Escape, sendshortcut,SHIFT,ampersand,
#bind = $mainMod, Escape, sendshortcut,CTRL,B, # c-b,& close window
#bind = $mainMod, Escape, sendshortcut,SHIFT,7, # somtimes it needs the orig key some time it needs the modified key like ampersand. doesnt seem to be very stable
#
#bind = $mainMod, S, sendshortcut,CTRL,B, # c-b,% split horrizontally
#bind = $mainMod, S, sendshortcut,SHIFT,5, # shift+5=%
#
#bind = $mainMod, V, sendshortcut,CTRL,B, # c-b," split vertically
#bind = $mainMod, V, sendshortcut,SHIFT,apostrophe,
#
#bind = $mainMod, X, sendshortcut,CTRL,B, # c-b,x close window
#bind = $mainMod, X, sendshortcut,,X,
## seem to work unstablly binding two modifier key at one time
##bind = $mainMod Shift, semicolon, sendshortcut,CTRL,B, # c-b,: tmux commands
##bindr = $mainMod Shift, semicolon, sendshortcut,Shift,colon, # very bizzare its not Shift+semicolon. i guess it has sth to do with key interp inside wayland or linux, and only mod and key both fits it would be good, but sometimes the mod changes the key like number keys and i guess colon is sth it doesnt change.yet sometimes it doesnt work, very strange.
#bind = $mainMod , semicolon, sendshortcut,CTRL,B, # c-b,: tmux commands
#bind = $mainMod , semicolon, sendshortcut,SHIFT,semicolon, 
#
#bind = $mainMod, J, sendshortcut,CTRL,B, # down pane
#bind = $mainMod, J, sendshortcut,,Down,
#
#bind = $mainMod, K, sendshortcut,CTRL,B, # up pane
#bind = $mainMod, K, sendshortcut,,Up,
#
#bind = $mainMod, H, sendshortcut,CTRL,B, # left pane
#bind = $mainMod, H, sendshortcut,,Left,
#
#bind = $mainMod, L, sendshortcut,CTRL,B, # right pane
#bind = $mainMod, L, sendshortcut,,Right,
## seem to work unstablly binding two modifier key at one time
##bind = $mainMod Shift, J, sendshortcut,CTRL,B, # down pane
##bindr = $mainMod Shift, J, sendshortcut,Shift,bracketleft,
##bind = $mainMod Shift, K, sendshortcut,CTRL,B, # up pane
##bindr = $mainMod Shift, K, sendshortcut,Shift,bracketright,
#
## exit tmux keyboard mode
#bind = $mainMod, Control_L, submap, reset
#bind = $mainMod, N, cyclenext # for focus on another window and leave tmux mode.
#bind = $mainMod, N, submap,reset # for floating windows, since J only controls windows in master layout
#submap = reset

# Move focus with mainMod + arrow keys
bind = $mainMod,H,layoutmsg,addmaster
bind = $mainMod,L,layoutmsg,removemaster
bind = $mainMod,N,cyclenext # for floating windows, since J only controls windows in master layout
bind = $mainMod,J,layoutmsg,cyclenext
bind = $mainMod,K,layoutmsg,cycleprev
bind = $mainMod Shift,J,layoutmsg,rollnext
bind = $mainMod Shift,K,layoutmsg,rollprev
bind = $mainMod,Return,layoutmsg,swapwithmaster master

# Switch workspaces with mainMod + [0-9]
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10
bind = $mainMod, minus, workspace, r-1
bind = $mainMod, equal, workspace, r+1

# Move active window to a workspace with mainMod + SHIFT + [0-9]
bind = $mainMod SHIFT, 1, movetoworkspacesilent, 1
bind = $mainMod SHIFT, 2, movetoworkspacesilent, 2
bind = $mainMod SHIFT, 3, movetoworkspacesilent, 3
bind = $mainMod SHIFT, 4, movetoworkspacesilent, 4
bind = $mainMod SHIFT, 5, movetoworkspacesilent, 5
bind = $mainMod SHIFT, 6, movetoworkspacesilent, 6
bind = $mainMod SHIFT, 7, movetoworkspacesilent, 7
bind = $mainMod SHIFT, 8, movetoworkspacesilent, 8
bind = $mainMod SHIFT, 9, movetoworkspacesilent, 9
bind = $mainMod SHIFT, 0, movetoworkspacesilent, 10
bind = $mainMod SHIFT, minus, movetoworkspacesilent, r-1
bind = $mainMod SHIFT, equal, movetoworkspacesilent, r+1

# Example special workspace (scratchpad)
bind = $mainMod, tab, togglespecialworkspace,scratchpad
bind = $mainMod SHIFT, tab, movetoworkspacesilent, special:scratchpad

# Scroll through existing workspaces with mainMod + scroll
bind = $mainMod, mouse_down, workspace, e+1
bind = $mainMod, mouse_up, workspace, e-1

# focus on montor or switch/move workspace to monitor
bind = $mainMod, backslash, focusmonitor, +1
bind = $mainMod SHIFT, backslash, movewindow, mon:+1 silent
bind = $mainMod, bracketleft, swapactiveworkspaces, current -1
bind = $mainMod, bracketright, swapactiveworkspaces, current +1
bind = $mainMod SHIFT, bracketleft, movecurrentworkspacetomonitor, -1
bind = $mainMod SHIFT, bracketleft, focusmonitor, +1
bind = $mainMod SHIFT, bracketright, movecurrentworkspacetomonitor, +1
bind = $mainMod SHIFT, bracketright, focusmonitor, +1

# Scroll through existing workspaces with mainMod + scroll
bind = $mainMod, mouse_down, workspace, e+1
bind = $mainMod, mouse_up, workspace, e-1

# Move/resize windows with mainMod + LMB/RMB and dragging
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow


##############################
### WINDOWS AND WORKSPACES ###
##############################

# See https://wiki.hyprland.org/Configuring/Window-Rules/ for more
# See https://wiki.hyprland.org/Configuring/Workspace-Rules/ for workspace rules

# Example windowrule v1
# windowrule = float, ^(kitty)$

# Example windowrule v2
# windowrulev2 = float,class:^(kitty)$,title:^(kitty)$

windowrule = suppressevent maximize, class:.* # You'll probably like this.
windowrule = opacity 0.9 override 0.85,class:^(kitty)$
windowrule = workspace 10 silent,class:^(?i)pcloud$
windowrule = fullscreen,class:^(mpv)$
windowrule = workspace 10 silent,class:^(kitty)$,title:^(~/pCloudDrive)$
windowrule = float,class:^(blueman-manager)$,title:^(Bluetooth Devices)$
windowrule = move 67% 5%,class:^(blueman-manager)$,title:^(Bluetooth Devices)$
windowrule = size 30% 70%,class:^(blueman-manager)$,title:^(Bluetooth Devices)$
windowrule = float,class:^(thunar)$,title:^(File Operation Progress)$
windowrule = float,class:^(thunar)$,title:^(文件操作进度)$
windowrule = move 73% 5%,class:^(thunar)$,title:^(File Operation Progress)$
windowrule = move 73% 5%,class:^(thunar)$,title:^(文件操作进度)$
windowrule = move 73% 5%,class:^(hyprland-dialog)$
windowrule = float,class:^(wechat)$,title:^(?!微信).+$
windowrule = size 50% 50%,class:^(wechat)$,title:^(?!微信).+$

workspace = special:scratchpad,on-created-empty:$terminal -e zsh -i -c 'aichat; zsh',gapsout:100,gapsin:4
